孤荷凌寒自学第131天
区块链045以太坊的 erc20代币15
【主要内容】
今天额外去研究批注了一个solidity智能合约，是简单众筹eth的智能合约。学习共用时28分钟。
（此外整理作笔记花费了约39分钟）
详细学习过程见文末学习过程屏幕录像。

【关于solidity中的时间处理】
主要学习的博文：https://www.jianshu.com/p/4b8e943ce7f2
了解到solidity语言中没有像python语言中那样有完整体系的日期处理模块及函数对象等，它的所有日期时间只有原始的时间戳对象(timestamp)。
摘录原文：
“
solidity使用自己的本地时间单位
变量 now 将返回当前的unix时间戳（自1970年1月1日以来经过的秒数）。
注意：Unix时间传统用一个32位的整数进行存储。这会导致“2038年”问题，当这个32位的unix时间戳不够用，产生溢出，使用这个时间的遗留系统就麻烦了。所以，如果我们想让我们的 DApp 跑够20年，我们可以使用64位整数表示时间，但为此我们的用户又得支付更多的 gas。
Solidity 还包含秒(seconds)，分钟(minutes)，小时(hours)，天(days)，周(weeks) 和 年(years) 等时间单位。它们都会转换成对应的秒数放入 uint 中。所以 1分钟 就是 60，1小时是 3600（60秒×60分钟），1天是86400（24小时×60分钟×60秒），以此类推。
下面是一些使用时间单位的实用案例：
```
uint lastUpdated;

// 将‘上次更新时间’ 设置为 ‘现在’
function updateTimestamp() public {
  lastUpdated = now;
}

// 如果到上次`updateTimestamp` 超过5分钟，返回 'true'
// 不到5分钟返回 'false'
function fiveMinutesHavePassed() public view returns (bool) {
  return (now >= (lastUpdated + 5 minutes));
}
```
 “

【对用以学习的这个智能合约进行了自主分析理解和批注】
```
pragma solidity ^0.4.7;

contract WoYaoZongChou{
    address owner; //此变量记录下合约部署者（拥有者）的地址
    uint public goal; //要众筹的目标金额（当然这儿指的是eth）
    uint public endtime; //是指此众筹的时长(是一个无符号整数，单位是秒），如果在从部署合约之日加上此天数后的日期期限内达到目的金额，则说明众筹目标达到，合约部署者可以取走所有众筹金额，否则就由参与众筹者自己退回自己那份钱。
    uint public total=0; //这是实际众筹到的金额
    
    mapping(address=>uint) gift; //每个参与众筹的节点地址实际捐赠的金额，即地址对应的金额
    
    //下面是合约的建构函数（只在部署时执行一次）
    //部署合约时，手动指定众筹的目标金额与众筹的时长（总数)
    constructor(uint _goal, uint _time) public{
        owner = msg.sender;
        goal = _goal;
        endtime = now + _time;
        //变量 now 将返回当前的unix时间戳（自1970年1月1日以来经过的秒数）。
        //来自博文：https://www.jianshu.com/p/4b8e943ce7f2
    }
    
    //调用合约的用户节点参与众筹，向合约地址转账一定数量的eth
    //这个函数给我的疑惑是，没有体现（像自己发的代币合约中的那样）登记eth余额双方的变化
    //初步理解是：
    //因为使用的代币正是eth本身，因此当调用此合约的节点在进行转移eth操作时，eth网络本身已经记录并广播完成了eth代币余额在两个节点之间的移动
    function donate() payable public{
        require(now < endtime);
        require(total < goal);
        require(msg.value > 0);
        gift[msg.sender] += msg.value; //在gift表中记录下当前节点增加了一定的捐赠金额（这意味着一个节点可以多次调用合约进行捐赠）
        total += msg.value; //让目前的实际众筹余额增加
    }
    
    //如果众筹成功，即在规定的时间内，众筹了大于等于goal预设数量金额的eth，那么证明成功，则合约的部署节点可以取走这笔eth到合约部署节点的账户上。
    function draw() public{
        require(msg.sender == owner); //首先要保证本次调用合约及调用本函数的节点是合约部署者。
        require(total > goal); //确实判断众筹目标已经达成。
        owner.transfer(address(this).balance); //执行转账，从合约地址转到部署合约的节点地址
        //eth代币的转账书写方法是非常简洁的:
        //接收转账金额的节点.transfer(转账金额)
        //这样指定【转账金额】的eth就会转移给【接收转账金额的节点】
    }
    
    //如果众筹失败，则参与众筹的节点可以调用合约的本方法来取回自己的捐赠
    function withdraw() public{
        require(now > endtime); //只有当众筹时间已过，本函数才可被调用
        require(total < goal); //确定判断众筹已经失败。
        uint amount = gift[msg.sender]; //获取当前调用合约的节点之前总共捐赠的eth的总金额
        total -= amount; //从总金额中减少当前调用合约节点准备取回的eth金额
        gift[msg.sender] = 0; //在gift表中，登记当前调用合约节点新的捐赠金额为0
        address(msg.sender).transfer(amount); //当前调用合约的节点之前总共捐赠的eth的总金额转移回当前调用合约的节点
    }
}


```
【学习后记】
通过今天的学习，我深刻认识到区块链的去中心化技术对解决信任所带来巨大改变——像众筹这样的活动，如果没有区块链技术，就一定需要一个中心化的组织（如那些众筹机构）来进行信任背书保证——这其实是没法完全消除信任危机的——因为任何中心化组织永远都不可以做到完全透明。
而有了智能合约这样的东西，这一切就变得非常简单了，因为智能合约一经部署就再也不能被修改，而智能合约的内容是公开透明了，如上面的两个函数【draw】【withdraw】,它的具体实现与约束每一个参与众筹的节点都看得清楚，且绝对相信这是不会被修改的，因此从根本上解决了信任问题。
后续如果能够通过智能合约解决众筹之后资金的使用过程的公开与信任，那么，区块链技术真的会完全改变世界。

【本阶段python区块链学习的一些感悟与小结】
到今天，我从零开始认识并学习区块链已经45天了，从对区块链这一技术完全毫无头绪，到今天已经对它有了非常深刻的理解，让我看到了一个广阔的未来图景。
到此本阶段区块链学习就告一段落，从明天起将暂停一段时间新知识的学习，转而进行实践项目，我主导的【就是要学】社群平台准备将学习积分系统通过ERC20智能合约进行上链，作为初学者，难度肯定有，但没有难度的事，就是毫无意义的事。我以为不断挑战自我，从一个又一个的舒适圈中走出来，才是精进的人生。


github: https://github.com/lhghroom/Self-learning-blockchain-from-scratch 
原文地址：https://www.941xue.com/content.aspx?id=1547 
【欢迎大家加入[就是要学]社群】
如今，这个世界的变化与科技的发展就像一个机器猛兽，它跑得越来越快，跑得越来越快，在我们身后追赶着我们。
很多人很早就放弃了成长，也就放弃了继续奔跑，多数人保持终身不变的样子，原地不动，成为那猛兽的肚中餐——当然那也不错，在猛兽的逼迫下，机械的重复着自我感觉还良好地稳定工作与生活——而且多半感觉不到这有什么不正常的地方，因为在猛兽肚子里的是大多数人，就好像大多数人都在一个大坑里，也就感觉不出来这是一个大坑了，反而坑外的世界显得有些不大正常。
为什么我们不要做坑里的大多数人？
因为真正的人生，应当有百万种可能 ；因为真正的一生可以有好多辈子组成，每一辈子都可以做自己喜欢的事情；因为真正的人生，应当有无数种可以选择的权利，而不是总觉得自己别无选择。因为我们要成为一九法则中为数不多的那个一；因为我们要成为自己人生的导演而不是被迫成为别人安排的戏目中的演员。
【请注意】
就是要学社群并不会告诉你怎样一夜暴富！也不会告诉你怎样不经努力就实现梦想！
【请注意】
就是要学社群并没有任何可以应付未来一切变化的独门绝技，也没有值得吹嘘的所谓价值连城的成功学方法论！
【请注意】
社群只会互相帮助，让每个人都看清自己在哪儿，自己是怎样的，重新看见心中的梦想，唤醒各自内心中的那个英雄，然后勇往直前，成为自己想要成为的样子！
期待与你并肩奔赴未来！
www.941xue.com 
QQ群：646854445 （【就是要学】终身成长）
 


【同步语音笔记】
https://www.ximalaya.com/keji/19103006/274964839 

【学习过程屏幕录屏】
链接：https://pan.baidu.com/s/1voRSniK0rP4r0NN4pCVOgA 
提取码：ofdu 
B站：https://www.bilibili.com/video/BV1Q541167tb/

